{"ast":null,"code":"import{fetchFormInputs,getPostURL,getNumSignupsAndTarget,showFullPageLoading,hideFullPageLoading,sendPetitionTracking}from\"./jquery.mc.form-helper.js\";var _window=window,$=_window.$;// handle form inilialize\n$(function(){// Generate the year selections\n// Min 20\n// Max Current year - 110\nvar nowYear=new Date().getFullYear();var targetYear=nowYear-110;for(var i=nowYear-20;i>=targetYear;i--){$(\"#Birthdate\").append($(\"<option>\",{value:i.toString()+\"-01-01\",text:i}));}// initialize the validations\n$(\"form.form-body\").validate({errorPlacement:function errorPlacement(error,element){console.log(error);// element.parents(\"div.form-field:first\").after( error );\nelement.after(error);},submitHandler:function submitHandler(form){showFullPageLoading();try{var defaults=fetchFormInputs(document.querySelector(\"form#mc-form\"));var userInputs=fetchFormInputs(document.querySelector(\"form.form-body\"));var postData=Object.assign(defaults,userInputs);console.log(postData);if(postData.MobilePhone){postData.MobilePhone=postData.MobilePhone.replace(/^0{1}/,\"\");}fetch(getPostURL(),{method:\"POST\",body:Object.keys(postData).reduce(function(formData,k){formData.append(k,postData[k]);return formData;},new FormData())}).then(function(response){return response.json();}).then(function(response){console.log(\"response\",response);hideFullPageLoading();changeToPage(2);if(response.Supporter){// ok, go to next page\nsendPetitionTracking(\"2020-amazon_forest\");}}).catch(function(error){hideFullPageLoading();// something wrong\nalert(error);console.error(error);});}catch(e){console.error(e);}return false;},invalidHandler:function invalidHandler(event,validator){// 'this' refers to the form\nvar errors=validator.numberOfInvalids();if(errors){// console.log(errors)\nvar message=errors===1?\"You missed 1 field. It has been highlighted\":\"You missed \"+errors+\" fields. They have been highlighted\";$(\"div.error\").show();}else{$(\"div.error\").hide();}}});});// handle page changes\nvar changeToPage=function changeToPage(pageNo){console.log(\"changeToPage\",pageNo);if(pageNo===1){$(\"#page-2\").hide();}else if(pageNo==2){$(\"#page-1\").hide();$(\"#page-2\").show();// scroll to the succ element\nif($(window).width()<=800){var enc=document.querySelector(\"#page-2\");var top=enc.getBoundingClientRect().top+window.pageYOffset;window.scrollTo(0,top);}}else{throw new Error(\"Unknow pageNo: \"+pageNo);}};// init\n$(function(){changeToPage(1);});","map":{"version":3,"sources":["/Users/cchan/Documents/GitHub/gpea-hongkong-pet-general_mc/src/App/main.js"],"names":["fetchFormInputs","getPostURL","getNumSignupsAndTarget","showFullPageLoading","hideFullPageLoading","sendPetitionTracking","window","$","nowYear","Date","getFullYear","targetYear","i","append","value","toString","text","validate","errorPlacement","error","element","console","log","after","submitHandler","form","defaults","document","querySelector","userInputs","postData","Object","assign","MobilePhone","replace","fetch","method","body","keys","reduce","formData","k","FormData","then","response","json","changeToPage","Supporter","catch","alert","e","invalidHandler","event","validator","errors","numberOfInvalids","message","show","hide","pageNo","width","enc","top","getBoundingClientRect","pageYOffset","scrollTo","Error"],"mappings":"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","sourcesContent":["import {\n  fetchFormInputs,\n  getPostURL,\n  getNumSignupsAndTarget,\n  showFullPageLoading,\n  hideFullPageLoading,\n  sendPetitionTracking,\n} from \"./jquery.mc.form-helper.js\";\nconst { $ } = window;\n// handle form inilialize\n$(() => {\n  // Generate the year selections\n  // Min 20\n  // Max Current year - 110\n  let nowYear = new Date().getFullYear();\n  let targetYear = nowYear - 110;\n  for (var i = nowYear - 20; i >= targetYear; i--) {\n    $(\"#Birthdate\").append(\n      $(\"<option>\", {\n        value: i.toString() + \"-01-01\",\n        text: i,\n      })\n    );\n  }\n\n  // initialize the validations\n\n  $(\"form.form-body\").validate({\n    errorPlacement: function (error, element) {\n      console.log(error);\n      // element.parents(\"div.form-field:first\").after( error );\n      element.after(error);\n    },\n    submitHandler: function (form) {\n      showFullPageLoading();\n\n      try {\n        let defaults = fetchFormInputs(document.querySelector(\"form#mc-form\"));\n        let userInputs = fetchFormInputs(\n          document.querySelector(\"form.form-body\")\n        );\n        let postData = Object.assign(defaults, userInputs);\n        console.log(postData);\n        if (postData.MobilePhone) {\n          postData.MobilePhone = postData.MobilePhone.replace(/^0{1}/, \"\");\n        }\n\n        fetch(getPostURL(), {\n          method: \"POST\",\n          body: Object.keys(postData).reduce((formData, k) => {\n            formData.append(k, postData[k]);\n            return formData;\n          }, new FormData()),\n        })\n          .then((response) => response.json())\n          .then((response) => {\n            console.log(\"response\", response);\n\n            hideFullPageLoading();\n            changeToPage(2);\n\n            if (response.Supporter) {\n              // ok, go to next page\n              sendPetitionTracking(\"2020-amazon_forest\");\n            }\n          })\n          .catch((error) => {\n            hideFullPageLoading(); // something wrong\n            alert(error);\n            console.error(error);\n          });\n      } catch (e) {\n        console.error(e);\n      }\n\n      return false;\n    },\n    invalidHandler: function (event, validator) {\n      // 'this' refers to the form\n      var errors = validator.numberOfInvalids();\n      if (errors) {\n        // console.log(errors)\n        var message =\n          errors === 1\n            ? \"You missed 1 field. It has been highlighted\"\n            : \"You missed \" + errors + \" fields. They have been highlighted\";\n        $(\"div.error\").show();\n      } else {\n        $(\"div.error\").hide();\n      }\n    },\n  });\n});\n\n// handle page changes\nconst changeToPage = (pageNo) => {\n  console.log(\"changeToPage\", pageNo);\n  if (pageNo === 1) {\n    $(\"#page-2\").hide();\n  } else if (pageNo == 2) {\n    $(\"#page-1\").hide();\n    $(\"#page-2\").show();\n\n    // scroll to the succ element\n    if ($(window).width() <= 800) {\n      let enc = document.querySelector(\"#page-2\");\n      let top = enc.getBoundingClientRect().top + window.pageYOffset;\n      window.scrollTo(0, top);\n    }\n  } else {\n    throw new Error(\"Unknow pageNo: \" + pageNo);\n  }\n};\n\n// init\n$(() => {\n  changeToPage(1);\n});\n"]},"metadata":{},"sourceType":"module"}