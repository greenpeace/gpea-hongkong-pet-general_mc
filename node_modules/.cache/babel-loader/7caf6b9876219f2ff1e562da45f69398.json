{"ast":null,"code":"import { fetchFormInputs, getPostURL, getNumSignupsAndTarget, showFullPageLoading, hideFullPageLoading, sendPetitionTracking } from \"./jquery.mc.form-helper.js\";\nconst {\n  $\n} = window; //\n\n$(() => {}); // handle form inilialize\n\n$(() => {\n  // Generate the year selections\n  let nowYear = new Date().getFullYear();\n  let targetYear = nowYear - 18;\n\n  for (var i = targetYear; i <= nowYear; i++) {\n    $(\"#birth\").append($(\"<option>\", {\n      value: i.toString() + \"-01-01\",\n      text: i\n    }));\n  } // initialize the validations\n\n\n  $(\"form.en__component\").validate({\n    errorPlacement: function (error, element) {\n      console.log(error); // element.parents(\"div.form-field:first\").after( error );\n\n      element.after(error);\n    },\n    submitHandler: function (form) {\n      showFullPageLoading();\n\n      try {\n        let defaults = fetchFormInputs(\"#mc-form\");\n        let userInputs = fetchFormInputs(form);\n        let postData = Object.assign(defaults, userInputs); // post-process values\n\n        if (postData.MobilePhone) {\n          postData.MobilePhone = postData.MobilePhone.replace(/^0{1}/, \"\");\n        }\n\n        fetch(getPostURL(), {\n          method: \"POST\",\n          body: Object.keys(postData).reduce((formData, k) => {\n            formData.append(k, postData[k]);\n            return formData;\n          }, new FormData())\n        }).then(response => response.json()).then(response => {\n          console.log(\"response\", response);\n          hideFullPageLoading();\n          changeToPage(2);\n\n          if (response.Supporter) {\n            // ok, go to next page\n            sendPetitionTracking(\"2020-ocean_sanctuaries_tao\");\n          }\n        }).catch(error => {\n          hideFullPageLoading(); // something wrong\n\n          alert(error);\n          console.error(error);\n        });\n      } catch (e) {\n        console.error(e);\n      }\n\n      return false;\n    },\n    invalidHandler: function (event, validator) {\n      // 'this' refers to the form\n      var errors = validator.numberOfInvalids();\n\n      if (errors) {\n        // console.log(errors)\n        var message = errors === 1 ? \"You missed 1 field. It has been highlighted\" : \"You missed \" + errors + \" fields. They have been highlighted\";\n        $(\"div.error\").show();\n      } else {\n        $(\"div.error\").hide();\n      }\n    }\n  });\n}); // handle page changes\n\nconst changeToPage = pageNo => {\n  console.log(\"changeToPage\", pageNo);\n\n  if (pageNo === 1) {\n    $(\"#page-2\").hide();\n  } else if (pageNo == 2) {\n    $(\"#page-1\").hide();\n    $(\"#page-2\").show(); // scroll to the succ element\n\n    if ($(window).width() <= 800) {\n      let enc = document.querySelector(\"#page-2\");\n      let top = enc.getBoundingClientRect().top + window.pageYOffset;\n      window.scrollTo(0, top);\n    }\n\n    document.querySelector(\".floating-signup-div\").remove();\n  } else {\n    throw new Error(\"Unknow pageNo: \" + pageNo);\n  }\n};","map":{"version":3,"sources":["/Users/cchan/Documents/GitHub/gpea-hongkong-pet-general_mc/src/App/main.js"],"names":["fetchFormInputs","getPostURL","getNumSignupsAndTarget","showFullPageLoading","hideFullPageLoading","sendPetitionTracking","$","window","nowYear","Date","getFullYear","targetYear","i","append","value","toString","text","validate","errorPlacement","error","element","console","log","after","submitHandler","form","defaults","userInputs","postData","Object","assign","MobilePhone","replace","fetch","method","body","keys","reduce","formData","k","FormData","then","response","json","changeToPage","Supporter","catch","alert","e","invalidHandler","event","validator","errors","numberOfInvalids","message","show","hide","pageNo","width","enc","document","querySelector","top","getBoundingClientRect","pageYOffset","scrollTo","remove","Error"],"mappings":"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","sourcesContent":["import {\n  fetchFormInputs,\n  getPostURL,\n  getNumSignupsAndTarget,\n  showFullPageLoading,\n  hideFullPageLoading,\n  sendPetitionTracking,\n} from \"./jquery.mc.form-helper.js\";\nconst { $ } = window;\n//\n$(() => {});\n\n// handle form inilialize\n$(() => {\n  // Generate the year selections\n  let nowYear = new Date().getFullYear();\n  let targetYear = nowYear - 18;\n  for (var i = targetYear; i <= nowYear; i++) {\n    $(\"#birth\").append(\n      $(\"<option>\", {\n        value: i.toString() + \"-01-01\",\n        text: i,\n      })\n    );\n  }\n\n  // initialize the validations\n\n  $(\"form.en__component\").validate({\n    errorPlacement: function (error, element) {\n      console.log(error);\n      // element.parents(\"div.form-field:first\").after( error );\n      element.after(error);\n    },\n    submitHandler: function (form) {\n      showFullPageLoading();\n\n      try {\n        let defaults = fetchFormInputs(\"#mc-form\");\n        let userInputs = fetchFormInputs(form);\n        let postData = Object.assign(defaults, userInputs);\n\n        // post-process values\n        if (postData.MobilePhone) {\n          postData.MobilePhone = postData.MobilePhone.replace(/^0{1}/, \"\");\n        }\n\n        fetch(getPostURL(), {\n          method: \"POST\",\n          body: Object.keys(postData).reduce((formData, k) => {\n            formData.append(k, postData[k]);\n            return formData;\n          }, new FormData()),\n        })\n          .then((response) => response.json())\n          .then((response) => {\n            console.log(\"response\", response);\n\n            hideFullPageLoading();\n            changeToPage(2);\n\n            if (response.Supporter) {\n              // ok, go to next page\n              sendPetitionTracking(\"2020-ocean_sanctuaries_tao\");\n            }\n          })\n          .catch((error) => {\n            hideFullPageLoading(); // something wrong\n            alert(error);\n            console.error(error);\n          });\n      } catch (e) {\n        console.error(e);\n      }\n\n      return false;\n    },\n    invalidHandler: function (event, validator) {\n      // 'this' refers to the form\n      var errors = validator.numberOfInvalids();\n      if (errors) {\n        // console.log(errors)\n        var message =\n          errors === 1\n            ? \"You missed 1 field. It has been highlighted\"\n            : \"You missed \" + errors + \" fields. They have been highlighted\";\n        $(\"div.error\").show();\n      } else {\n        $(\"div.error\").hide();\n      }\n    },\n  });\n});\n\n// handle page changes\nconst changeToPage = (pageNo) => {\n  console.log(\"changeToPage\", pageNo);\n  if (pageNo === 1) {\n    $(\"#page-2\").hide();\n  } else if (pageNo == 2) {\n    $(\"#page-1\").hide();\n    $(\"#page-2\").show();\n\n    // scroll to the succ element\n    if ($(window).width() <= 800) {\n      let enc = document.querySelector(\"#page-2\");\n      let top = enc.getBoundingClientRect().top + window.pageYOffset;\n      window.scrollTo(0, top);\n    }\n\n    document.querySelector(\".floating-signup-div\").remove();\n  } else {\n    throw new Error(\"Unknow pageNo: \" + pageNo);\n  }\n};\n"]},"metadata":{},"sourceType":"module"}