{"ast":null,"code":"import{fetchFormInputs,getPostURL// getNumSignupsAndTarget,\n,showFullPageLoading,hideFullPageLoading,sendPetitionTracking}from\"./jquery.mc.form-helper.js\";import{mainShare,whatsAppShare}from\"./share.js\";var _window=window,$=_window.$;//\n$(function(){// Generate the year selections\nvar nowYear=new Date().getFullYear();var targetYear=nowYear-110;for(var i=nowYear-20;i>=targetYear;i--){$(\"#Birthdate\").append($(\"<option>\",{value:i.toString()+\"-01-01\",text:i}));}// initialize the validations\n$(\"form.form-body\").validate({errorPlacement:function errorPlacement(error,element){// console.log(error);\nelement.after(error);},submitHandler:function submitHandler(form){showFullPageLoading();try{var defaults=fetchFormInputs(document.querySelector(\"form#mc-form\"));var userInputs=fetchFormInputs(document.querySelector(\"form.form-body\"));var postData=Object.assign(defaults,userInputs);// console.log(postData);\nif(postData.MobilePhone){postData.MobilePhone=postData.MobilePhone.replace(/^0{1}/,\"\");}fetch(getPostURL(),{method:\"POST\",body:Object.keys(postData).reduce(function(formData,k){formData.append(k,postData[k]);return formData;},new FormData())}).then(function(response){return response.json();}).then(function(response){console.log(\"response\",response);hideFullPageLoading();changeToPage(2);if(response.Supporter){// ok, go to next page\nsendPetitionTracking(\"2020-amazon_forest\");}}).catch(function(error){hideFullPageLoading();// something wrong\nalert(error);console.error(error);});}catch(e){console.error(e);}return false;},invalidHandler:function invalidHandler(event,validator){var errors=validator.numberOfInvalids();if(errors){console.log(errors);$(\"div.error\").show();}else{$(\"div.error\").hide();}}});});// handle page changes\nvar changeToPage=function changeToPage(pageNo){console.log(\"changeToPage\",pageNo);if(pageNo===1){$(\"#page-2\").hide();}else if(pageNo===2){$(\"#page-1\").hide();$(\"#page-2\").show();// scroll to the succ element\nif($(window).width()<=800){var enc=document.querySelector(\"#page-2\");var top=enc.getBoundingClientRect().top+window.pageYOffset;window.scrollTo(0,top);}document.querySelectorAll(\".signup-now\").forEach(function(cta){cta.innerHTML=\"支持我們\";});}else{throw new Error(\"Unknow pageNo: \"+pageNo);}};// init\n$(function(){changeToPage(1);//\ndocument.querySelector(\".form-button--whatsapp\").addEventListener(\"click\",whatsAppShare);document.querySelector(\".form-button--share\").addEventListener(\"click\",mainShare);});","map":{"version":3,"sources":["/Users/cchan/Documents/GitHub/gpea-hongkong-pet-general_mc/src/scripts/index.js"],"names":["fetchFormInputs","getPostURL","showFullPageLoading","hideFullPageLoading","sendPetitionTracking","mainShare","whatsAppShare","window","$","nowYear","Date","getFullYear","targetYear","i","append","value","toString","text","validate","errorPlacement","error","element","after","submitHandler","form","defaults","document","querySelector","userInputs","postData","Object","assign","MobilePhone","replace","fetch","method","body","keys","reduce","formData","k","FormData","then","response","json","console","log","changeToPage","Supporter","catch","alert","e","invalidHandler","event","validator","errors","numberOfInvalids","show","hide","pageNo","width","enc","top","getBoundingClientRect","pageYOffset","scrollTo","querySelectorAll","forEach","cta","innerHTML","Error","addEventListener"],"mappings":"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","sourcesContent":["import {\n  fetchFormInputs,\n  getPostURL,\n  // getNumSignupsAndTarget,\n  showFullPageLoading,\n  hideFullPageLoading,\n  sendPetitionTracking,\n} from \"./jquery.mc.form-helper.js\";\nimport { mainShare, whatsAppShare } from \"./share.js\";\nconst { $ } = window;\n//\n$(() => {\n  // Generate the year selections\n  let nowYear = new Date().getFullYear();\n  let targetYear = nowYear - 110;\n  for (var i = nowYear - 20; i >= targetYear; i--) {\n    $(\"#Birthdate\").append(\n      $(\"<option>\", {\n        value: i.toString() + \"-01-01\",\n        text: i,\n      })\n    );\n  }\n\n  // initialize the validations\n\n  $(\"form.form-body\").validate({\n    errorPlacement: function (error, element) {\n      // console.log(error);\n      element.after(error);\n    },\n    submitHandler: function (form) {\n      showFullPageLoading();\n      try {\n        let defaults = fetchFormInputs(document.querySelector(\"form#mc-form\"));\n        let userInputs = fetchFormInputs(\n          document.querySelector(\"form.form-body\")\n        );\n        let postData = Object.assign(defaults, userInputs);\n        // console.log(postData);\n        if (postData.MobilePhone) {\n          postData.MobilePhone = postData.MobilePhone.replace(/^0{1}/, \"\");\n        }\n\n        fetch(getPostURL(), {\n          method: \"POST\",\n          body: Object.keys(postData).reduce((formData, k) => {\n            formData.append(k, postData[k]);\n            return formData;\n          }, new FormData()),\n        })\n          .then((response) => response.json())\n          .then((response) => {\n            console.log(\"response\", response);\n\n            hideFullPageLoading();\n            changeToPage(2);\n\n            if (response.Supporter) {\n              // ok, go to next page\n              sendPetitionTracking(\"2020-amazon_forest\");\n            }\n          })\n          .catch((error) => {\n            hideFullPageLoading(); // something wrong\n            alert(error);\n            console.error(error);\n          });\n      } catch (e) {\n        console.error(e);\n      }\n      return false;\n    },\n    invalidHandler: function (event, validator) {\n      var errors = validator.numberOfInvalids();\n      if (errors) {\n        console.log(errors);\n        $(\"div.error\").show();\n      } else {\n        $(\"div.error\").hide();\n      }\n    },\n  });\n});\n\n// handle page changes\nconst changeToPage = (pageNo) => {\n  console.log(\"changeToPage\", pageNo);\n  if (pageNo === 1) {\n    $(\"#page-2\").hide();\n  } else if (pageNo === 2) {\n    $(\"#page-1\").hide();\n    $(\"#page-2\").show();\n\n    // scroll to the succ element\n    if ($(window).width() <= 800) {\n      let enc = document.querySelector(\"#page-2\");\n      let top = enc.getBoundingClientRect().top + window.pageYOffset;\n      window.scrollTo(0, top);\n    }\n\n    document.querySelectorAll(\".signup-now\").forEach((cta) => {\n      cta.innerHTML = \"支持我們\";\n    });\n  } else {\n    throw new Error(\"Unknow pageNo: \" + pageNo);\n  }\n};\n\n// init\n$(() => {\n  changeToPage(1);\n  //\n  document\n    .querySelector(\".form-button--whatsapp\")\n    .addEventListener(\"click\", whatsAppShare);\n  document\n    .querySelector(\".form-button--share\")\n    .addEventListener(\"click\", mainShare);\n});\n"]},"metadata":{},"sourceType":"module"}