{"ast":null,"code":"// import $ from \"jquery\";\nimport { fetchFormInputs, getPostURL // getNumSignupsAndTarget,\n, showFullPageLoading, hideFullPageLoading, sendPetitionTracking } from \"./jquery.mc.form-helper.js\";\nimport { mainShare, whatsAppShare } from \"./share.js\";\nimport parallax from \"./parallax.js\"; //\n\nconst {\n  $\n} = window; //\n\n$(() => {\n  //\n  let nowYear = new Date().getFullYear();\n  let targetYear = nowYear - 110;\n\n  for (var i = nowYear - 20; i >= targetYear; i--) {\n    $(\"#Birthdate\").append($(\"<option>\", {\n      value: i.toString() + \"-01-01\",\n      text: i\n    }));\n  } // initialize the validations\n\n\n  $(\"form.form-body\").validate({\n    errorPlacement: function (error, element) {\n      // console.log(error);\n      element.after(error);\n    },\n    submitHandler: function (form) {\n      showFullPageLoading();\n\n      try {\n        let defaults = fetchFormInputs(document.querySelector(\"form#mc-form\"));\n        let userInputs = fetchFormInputs(document.querySelector(\"form.form-body\"));\n        let postData = Object.assign(defaults, userInputs); // console.log(postData);\n\n        if (postData.MobilePhone) {\n          postData.MobilePhone = postData.MobilePhone.replace(/^0{1}/, \"\");\n        }\n\n        fetch(getPostURL(), {\n          method: \"POST\",\n          body: Object.keys(postData).reduce((formData, k) => {\n            formData.append(k, postData[k]);\n            return formData;\n          }, new FormData())\n        }).then(response => response.json()).then(response => {\n          console.log(\"response\", response);\n          hideFullPageLoading();\n          changeToPage(2);\n\n          if (response.Supporter) {\n            sendPetitionTracking(\"2020-amazon_forest\");\n          }\n        }).catch(error => {\n          hideFullPageLoading(); // something wrong\n\n          alert(error);\n          console.error(error);\n        });\n      } catch (e) {\n        console.error(e);\n      }\n\n      return false;\n    },\n    invalidHandler: function (event, validator) {\n      var errors = validator.numberOfInvalids();\n\n      if (errors) {\n        console.log(errors);\n        $(\"div.error\").show();\n      } else {\n        $(\"div.error\").hide();\n      }\n    }\n  });\n}); // handle page changes\n\nconst changeToPage = pageNo => {\n  console.log(\"changeToPage\", pageNo);\n\n  if (pageNo === 1) {\n    $(\"#page-2\").hide();\n  } else if (pageNo === 2) {\n    $(\"#page-1\").hide();\n    $(\"#page-2\").show();\n    let enc = document.querySelector(\"#page-2\");\n    let top = enc.getBoundingClientRect().top + window.pageYOffset;\n    window.scrollTo(0, top);\n    document.querySelectorAll(\".signup-now\").forEach(cta => {\n      cta.innerHTML = \"支持我們\";\n    });\n  } else {\n    throw new Error(\"Unknown pageNo: \" + pageNo);\n  }\n};\n\nconst handleScroll = () => {\n  const yPost = window.scrollY;\n  const signupOffset = document.querySelector(\"section .signup-now\").offsetTop;\n\n  if (yPost > signupOffset) {\n    console.log(\"passed\");\n  }\n}; // init\n\n\ndocument.addEventListener(\"DOMContentLoaded\", function (event) {\n  parallax();\n  changeToPage(1);\n  document.querySelector(\".form-button--whatsapp\").addEventListener(\"click\", whatsAppShare);\n  document.querySelector(\".form-button--share\").addEventListener(\"click\", mainShare);\n  window.addEventListener(\"scroll\", handleScroll);\n});","map":{"version":3,"sources":["/Users/cchan/Documents/GitHub/gpea-hongkong-pet-general_mc/src/scripts/index.js"],"names":["fetchFormInputs","getPostURL","showFullPageLoading","hideFullPageLoading","sendPetitionTracking","mainShare","whatsAppShare","parallax","$","window","nowYear","Date","getFullYear","targetYear","i","append","value","toString","text","validate","errorPlacement","error","element","after","submitHandler","form","defaults","document","querySelector","userInputs","postData","Object","assign","MobilePhone","replace","fetch","method","body","keys","reduce","formData","k","FormData","then","response","json","console","log","changeToPage","Supporter","catch","alert","e","invalidHandler","event","validator","errors","numberOfInvalids","show","hide","pageNo","enc","top","getBoundingClientRect","pageYOffset","scrollTo","querySelectorAll","forEach","cta","innerHTML","Error","handleScroll","yPost","scrollY","signupOffset","offsetTop","addEventListener"],"mappings":"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","sourcesContent":["// import $ from \"jquery\";\nimport {\n  fetchFormInputs,\n  getPostURL,\n  // getNumSignupsAndTarget,\n  showFullPageLoading,\n  hideFullPageLoading,\n  sendPetitionTracking,\n} from \"./jquery.mc.form-helper.js\";\nimport { mainShare, whatsAppShare } from \"./share.js\";\nimport parallax from \"./parallax.js\";\n//\nconst { $ } = window;\n//\n$(() => {\n  //\n  let nowYear = new Date().getFullYear();\n  let targetYear = nowYear - 110;\n  for (var i = nowYear - 20; i >= targetYear; i--) {\n    $(\"#Birthdate\").append(\n      $(\"<option>\", {\n        value: i.toString() + \"-01-01\",\n        text: i,\n      })\n    );\n  }\n  // initialize the validations\n  $(\"form.form-body\").validate({\n    errorPlacement: function (error, element) {\n      // console.log(error);\n      element.after(error);\n    },\n    submitHandler: function (form) {\n      showFullPageLoading();\n      try {\n        let defaults = fetchFormInputs(document.querySelector(\"form#mc-form\"));\n        let userInputs = fetchFormInputs(\n          document.querySelector(\"form.form-body\")\n        );\n        let postData = Object.assign(defaults, userInputs);\n        // console.log(postData);\n        if (postData.MobilePhone) {\n          postData.MobilePhone = postData.MobilePhone.replace(/^0{1}/, \"\");\n        }\n\n        fetch(getPostURL(), {\n          method: \"POST\",\n          body: Object.keys(postData).reduce((formData, k) => {\n            formData.append(k, postData[k]);\n            return formData;\n          }, new FormData()),\n        })\n          .then((response) => response.json())\n          .then((response) => {\n            console.log(\"response\", response);\n\n            hideFullPageLoading();\n            changeToPage(2);\n\n            if (response.Supporter) {\n              sendPetitionTracking(\"2020-amazon_forest\");\n            }\n          })\n          .catch((error) => {\n            hideFullPageLoading(); // something wrong\n            alert(error);\n            console.error(error);\n          });\n      } catch (e) {\n        console.error(e);\n      }\n      return false;\n    },\n    invalidHandler: function (event, validator) {\n      var errors = validator.numberOfInvalids();\n      if (errors) {\n        console.log(errors);\n        $(\"div.error\").show();\n      } else {\n        $(\"div.error\").hide();\n      }\n    },\n  });\n});\n\n// handle page changes\nconst changeToPage = (pageNo) => {\n  console.log(\"changeToPage\", pageNo);\n  if (pageNo === 1) {\n    $(\"#page-2\").hide();\n  } else if (pageNo === 2) {\n    $(\"#page-1\").hide();\n    $(\"#page-2\").show();\n\n    let enc = document.querySelector(\"#page-2\");\n    let top = enc.getBoundingClientRect().top + window.pageYOffset;\n    window.scrollTo(0, top);\n\n    document.querySelectorAll(\".signup-now\").forEach((cta) => {\n      cta.innerHTML = \"支持我們\";\n    });\n  } else {\n    throw new Error(\"Unknown pageNo: \" + pageNo);\n  }\n};\n\nconst handleScroll = () => {\n  const yPost = window.scrollY;\n  const signupOffset = document.querySelector(\"section .signup-now\").offsetTop;\n  if (yPost > signupOffset) {\n    console.log(\"passed\");\n  }\n};\n\n// init\ndocument.addEventListener(\"DOMContentLoaded\", function (event) {\n  parallax();\n  changeToPage(1);\n  document\n    .querySelector(\".form-button--whatsapp\")\n    .addEventListener(\"click\", whatsAppShare);\n  document\n    .querySelector(\".form-button--share\")\n    .addEventListener(\"click\", mainShare);\n  window.addEventListener(\"scroll\", handleScroll);\n});\n"]},"metadata":{},"sourceType":"module"}